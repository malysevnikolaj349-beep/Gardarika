# Gardarika Domain Core (MVP scaffold)

Этот репозиторий содержит доменный слой для Telegram/MMORPG проекта "Гардарика". Реализация следует условиям `gardarika_codex_contract_v1.txt` и концентрируется на неизменяемых правилах: движение по карте 16×16, пошаговые бои с полной энергией на старте, персистентное состояние мобов и налог с боёв. Добавлены каркасы для выбора родного города, админ-доступа через Telegram WebApp и видимости лута. В комплект входит CLI-демо, показывающее движение по сетке, переходы, бой и налоговую логистику.

## Что внутри
- `src/gardarika/models.py` — базовые датаклассы для игроков, локаций, городов, княжеств, предметов и боёв.
- `src/gardarika/game_engine.py` — операции доменного уровня для перемещения, переходов между локациями, запуска/ведения боя, применения навыков, расчёта налогов и миграции мобов.
- `src/gardarika/spawn.py` — выбор родного города с учётом spawn_enabled/ёмкости.
- `src/gardarika/admin.py` — проверка доступа в админку через Telegram WebApp initData и модель аудита.
- `src/gardarika/loot.py` — разделение лута после смерти на видимый убийце, на земле и скрытый.
- `tests/` — набор тестов, проверяющих ключевые инварианты (энергия в начале боя, невозможность восстановления энергии в бою, персистентность HP мобов, запрет миграции мобов в safe-zones, невозможность перехода между локациями вне края, выбор родного города, требования к initData для админов и видимость лута).
- `src/gardarika/app.py` — запускаемый CLI-сценарий, демонстрирующий основные контрактные правила без Telegram-UI.

## Локальный запуск
Требуется Python 3.11+.

```bash
python -m venv .venv
source .venv/bin/activate
pip install -e .
pip install pytest
pytest
```

### Запуск демонстрации (CLI)

После установки в editable-режиме появляется скрипт `gardarika-demo`:

```bash
gardarika-demo          # сценарий по умолчанию: движение→переход между локациями→бой→налог
gardarika-demo render   # вывести стартовую 16×16 карту с позицией игрока
```

Демонстрация использует детерминированные данные и выводит шаги текстом, чтобы их можно было проверить без Telegram/WebApp.

## Ограничения
- Это доменный скелет без Telegram-бота и админки; UI/IO слой отсутствует намеренно.
- Многие поля и операции оставлены как TODO, чтобы избежать домыслов сверх контракта.

